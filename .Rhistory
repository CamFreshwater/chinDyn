fitList[[1]]
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5,
width = 6, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
listStkNames
rownames(survList[[1]])
head(eyDatFull)
head(eyDat)
eyDatFull <- eyDat %>%
mutate(lat = as.numeric(lat),
long = as.numeric(long),
aggReg = case_when(
(is.na(lat)) ~ "north",
(lat > 52 & !region == "UFR") ~ "north",
(region %in% c("JFUCA", "LCOLR", "MCOLR", "ORCST", "UCOLR", "WACST",
"WCVI")) ~ "south",
TRUE ~ "SS"
)) %>%
mutate(grp = paste(smoltType, aggReg, sep = "_")) %>%
filter(!grp %in% c("oceantype_north", "streamtype_south")) %>%
arrange(desc(lat)) %>%
mutate(stock = factor(stock, unique(stock)),
grp = factor(grp, unique(grp))) %>%
select(-jurisdiction, -lat, -long)  %>%
mutate(grp = fct_recode(grp, "Yearling\nNorth" = "streamtype_north",
"Yearling\nSalish Sea" = "streamtype_SS",
"Subyearling\nSalish Sea" = "oceantype_SS",
"Subyearling\nSouth" = "oceantype_south"))
head(eyDatFull)
eyDatFull %>%
filter(grpp == "Subyearling\nSalish Sea") %>%
select(stock, stockName) %>%
distinct()
eyDatFull %>%
filter(grp == "Subyearling\nSalish Sea") %>%
select(stock, stockName) %>%
distinct()
listStkNames[[1]]
listStkNames[[3]]
eyDatFull %>%
filter(grp == "Subyearling\nSalish Sea") %>%
select(stockName) %>%
distinct() %>% as.vector()
#manually change stock names for subyearling Salish Sea only
listStkNames[[3]] <- c("L. Shuswap", "Quinsam", "Puntledge", "Big Qualicum",
"Harrison", "Chilliwack", "Cowichan",
"Samish", "Skagit Spring", "Skagit Summer",
"Stillaguamish ", "Skykomish", "George Adams",
"Nisqually", "S. Puget Sound")
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX()
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5,
width = 6, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
listStkNames[[3]]
listStkNames[[1]]
rownames(survList[[1]])
#manually change stock names for subyearling Salish Sea only
listStkNames[[3]] <- c("L. Shuswap", "Quinsam", "Puntledge", "Big Qualicum",
"Harrison", "Chilliwack", "Cowichan",
"Samish", "Skagit Spring", "Skagit Summer",
"Stillaguamish ", "Skykomish", "George Adams",
"Nisqually", "S. Puget Sound")
numSeq <- seq(1, length(listStkNames[[3]]), by = 1)
out <- vector(mode = "character", length = length(numSeq))
setNames(listStkNames[[3]], numSeq)
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX()
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5,
width = 6, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
x <- 3
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX()
listStkNames <- lapply(survList, function(x) {
name <- rownames(x)
numSeq <- seq(1, length(name), by = 1)
out <- vector(mode = "character", length = length(numSeq))
setNames(name, numSeq)
})
plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX()
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX()
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5,
width = 6, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
x <- 3
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
samSim::theme_sleekX
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
x <- 3
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
plot(fitList[[x]])
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 8)
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
x <- 3
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
trendList <- lapply(seq_along(rotList), function(x) {
p <- plot_trendsX(rotList[[x]], oneTrend = TRUE, startYr = 1972) +
labs(title = names(survList)[x], x = "Ocean Entry Year",
y = "Survival Trend") +
samSim::theme_sleekX()
return(p)
})
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov",
"dominantCoastTrends.png"), height = 6,
width = 6, units = "in", res = 300)
ggpubr::ggarrange(trendList[[1]], trendList[[2]], trendList[[3]],
trendList[[4]],  ncol = 2, nrow = 2)
dev.off()
x <- 1
plot_fittedX(mod, startYr = 1972) +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
listStkNames[[3]]
head(eyDatFull)
listStkNames[3]
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972, names = listStkNames[[3]]) +
ggtitle(names(survList)[x]) +
# facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
#            scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
x
plot_fittedX(mod, startYr = 1972, names = listStkNames[[x]]) +
ggtitle(names(survList)[x]) +
# facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
#            scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
x <- 3
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972, names = listStkNames[[x]]) +
ggtitle(names(survList)[x]) +
# facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
#            scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
names(listStkNames)
head(eyFullDat)
head(eyDatFull)
eyFullDat %>%
filter(aggReg == "SS") %>%
select(stk, stkName, aggReg) %>%
arrange(smoltType) %>%
distinct
eyDatFull %>%
filter(aggReg == "SS") %>%
select(stk, stkName, aggReg) %>%
arrange(smoltType) %>%
distinct
eyDatFull %>%
filter(aggReg == "SS") %>%
select(stock, stkName, aggReg) %>%
arrange(smoltType) %>%
distinct
eyDatFull %>%
filter(aggReg == "SS") %>%
select(stock, stockName, aggReg) %>%
arrange(smoltType) %>%
distinct
eyDatFull %>%
filter(aggReg == "SS") %>%
select(stock, stockName, aggReg, smoltType) %>%
arrange(smoltType) %>%
distinct
listStkNames[[3]] <- c("Big Qualicum", "Chilliwack", "Cowichan", "George Adams",
"Harrison", "Nanaimo", "Nisqually", "Puntledge", "Quinsam",
"Samish Fall", "L. Shuswap", "Skagit Fall", "Skykomish",
"S. Puget Sound", "Skagit Summ.", "Stillaguamish")
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972, names = listStkNames[[x]]) +
ggtitle(names(survList)[x]) +
# facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
#            scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
x
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972, names = listStkNames[[x]]) +
ggtitle(names(survList)[x]) +
# facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
#            scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
plot_fittedX <- function (modelfit, names = NULL, startYr = 1972,
dotCol = "red") {
n_ts <- dim(modelfit$data)[1]
n_years <- dim(modelfit$data)[2]
pred <- predicted(modelfit)
df <- data.frame(ID = rep(seq_len(n_ts), n_years),
Time = sort(rep(seq_len(n_years), n_ts)),
mean = c(t(apply(pred, c(3, 4), mean))),
lo = c(t(apply(pred, c(3, 4), quantile, 0.025))),
hi = c(t(apply(pred, c(3,  4), quantile, 0.975))),
y = c(modelfit$data)) %>%
dplyr::mutate(timeT = (startYr - 1 + Time))
if (!is.null(names)) {
df$ID <- names[df$ID]
}
p1 <- ggplot(df, aes_string(x = "timeT", y = "mean")) +
geom_ribbon(aes_string(ymin = "lo",  ymax = "hi"), alpha = 0.4) +
geom_line() + geom_point(aes_string(x = "timeT", y = "y"), col = dotCol,
size = 0.5, alpha = 0.4) +
facet_wrap("ID",  scales = "free_y") +
xlab("Ocean Entry Year") +
ylab("Survival Anomaly")
p1
}
## Ugly custom plot versions for pres
plot_fittedX(dum[[1]], startYr = 1972, dotCol = "blue") +
ggtitle(names(survList)[1]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[1]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
plot_fittedX <- function (modelfit, names = NULL, startYr = 1972,
dotCol = "red") {
n_ts <- dim(modelfit$data)[1]
n_years <- dim(modelfit$data)[2]
pred <- predicted(modelfit)
df <- data.frame(ID = rep(seq_len(n_ts), n_years),
Time = sort(rep(seq_len(n_years), n_ts)),
mean = c(t(apply(pred, c(3, 4), mean))),
lo = c(t(apply(pred, c(3, 4), quantile, 0.025))),
hi = c(t(apply(pred, c(3,  4), quantile, 0.975))),
y = c(modelfit$data)) %>%
dplyr::mutate(timeT = (startYr - 1 + Time))
if (!is.null(names)) {
df$ID <- names[df$ID]
}
p1 <- ggplot(df, aes_string(x = "timeT", y = "mean")) +
geom_ribbon(aes_string(ymin = "lo",  ymax = "hi"), alpha = 0.4) +
geom_line() + geom_point(aes_string(x = "timeT", y = "y"), col = dotCol,
size = 0.75, alpha = 0.6) +
facet_wrap("ID",  scales = "free_y") +
xlab("Ocean Entry Year") +
ylab("Survival Anomaly")
p1
}
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- if (x == 2) {
plot_fittedX(mod, startYr = 1972, dotCol = "blue")
} else {
plot_fittedX(mod, startYr = 1972)
}
p <- p +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
x <- 2
fitList[[2]]
fitList[[3]]
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- if (x == 2) {
plot_fittedX(mod, startYr = 1972, dotCol = "blue")
} else {
plot_fittedX(mod, startYr = 1972)
}
p <- p +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
head(eyDatFull)
x
x <- 3
listStkNames[[x]]
listStkNames <- lapply(survList, function(x) {
name <- rownames(x)
numSeq <- seq(1, length(name), by = 1)
out <- vector(mode = "character", length = length(numSeq))
setNames(name, numSeq)
})
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- if (x == 2) {
plot_fittedX(mod, startYr = 1972, dotCol = "blue")
} else {
plot_fittedX(mod, startYr = 1972)
}
p <- p +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
fitList[[3]]
eyDatFull %>%
filter(stock %in% c("SHU", "QUI"),
!is.na(surv))
eyDatFull %>%
filter(stock %in% c("SHU", "QUI"),
!is.na(surv)) %>%
summarize(min(OEY))
eyDatFull %>%
filter(stock %in% c("SHU", "QUI"),
!is.na(surv)) %>%
group_by(stock) %>%
summarize(min(OEY))
eyDatFull %>%
filter(stock %in% c("SHU", "QUI", "NIS"),
!is.na(surv)) %>%
group_by(stock) %>%
summarize(min(OEY))
x <- 2
mod <- dum[[x]]
plot_fittedX(mod, startYr = 1972, dotCol = "#B79F00")
plot_fittedX(mod, startYr = 1972, dotCol = "#00BFC4")
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- if (x == 2) {
plot_fittedX(mod, startYr = 1972, dotCol = "#00BFC4")
} else {
plot_fittedX(mod, startYr = 1972)
}
p <- p +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
plot_fittedX <- function (modelfit, names = NULL, startYr = 1972,
dotCol = "red") {
n_ts <- dim(modelfit$data)[1]
n_years <- dim(modelfit$data)[2]
pred <- predicted(modelfit)
df <- data.frame(ID = rep(seq_len(n_ts), n_years),
Time = sort(rep(seq_len(n_years), n_ts)),
mean = c(t(apply(pred, c(3, 4), mean))),
lo = c(t(apply(pred, c(3, 4), quantile, 0.025))),
hi = c(t(apply(pred, c(3,  4), quantile, 0.975))),
y = c(modelfit$data)) %>%
dplyr::mutate(timeT = (startYr - 1 + Time))
if (!is.null(names)) {
df$ID <- names[df$ID]
}
p1 <- ggplot(df, aes_string(x = "timeT", y = "mean")) +
geom_ribbon(aes_string(ymin = "lo",  ymax = "hi"), alpha = 0.4) +
geom_line() + geom_point(aes_string(x = "timeT", y = "y"), col = dotCol,
size = 0.9, alpha = 0.5) +
facet_wrap("ID",  scales = "free_y") +
xlab("Ocean Entry Year") +
ylab("Survival Anomaly")
p1
}
fitList <- lapply(seq_along(dum), function(x) {
mod <- dum[[x]]
p <- if (x == 2) {
plot_fittedX(mod, startYr = 1972, dotCol = "#00BFC4")
} else {
plot_fittedX(mod, startYr = 1972)
}
p <- p +
ggtitle(names(survList)[x]) +
facet_wrap("ID", labeller = as_labeller(listStkNames[[x]]),
scales = "free_y") +
samSim::theme_sleekX(axisSize = 9)
return(p)
})
for(x in seq_along(fitList)) {
fileName <- paste(abbreviate(names(survList)[x], 6), "3TrendFits.png",
sep = "_")
png(here("figs", "dfa", "rangeWideBayes", "3Trends_EqualCov", fileName),
height = 5.25,
width = 6.5, units = "in", res = 300)
plot(fitList[[x]])
dev.off()
}
exp(0.2)
exp(0.5)
log(0.5)
log10(0.5)
