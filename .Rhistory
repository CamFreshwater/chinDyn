# RKW
k_mod <- gam(gen_length ~  s(rkw_z, by = a_group2, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re") +
a_group2,
data = dat)
k_modB <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_modC <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
AIC(k_mod, k_modB, k_modC)
k_modC <- gam(gen_length ~ s(rkw_z, by = a_group2, m = 2, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_modD <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
AIC(k_mod, k_modB, k_modC, k_modD)
# Combined models to resolve whether relationships are additive
h_hj_mod <- gam(gen_length ~ s(herr_OEY_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 4) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(herr_OEY_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_h_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_h_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 4) +
s(herr_OEY_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_hj_mod)
# Herring at entry - global smooth for juveniles strongly supported
hj_mod1 <- gam(gen_length ~ s(herr_OEY_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_mod2 <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
# Herring at one year lags: model structure supports model 1
h_mod1 <- gam(gen_length ~ s(herr_OEY1_z, m = 2, bs = "tp", k = 4) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_hj_mod)
summary(k_h_hj_mod)
glimpse(dat)
dat %>%
select(brood_year, herr_OEY_z, herr_OEY1_z, rkw_z) %>%
distinct()
# look at covariation among covariates
dat %>%
select(brood_year, herr_OEY_z, herr_OEY1_z, rkw_z) %>%
as.matrix() %>%
cor()
# look at covariation among covariates
dat %>%
select(brood_year, herr_OEY_z, herr_OEY1_z, rkw_z) %>%
as.matrix() %>%
cor() %>%
corrplot::corrplot(corCov, method = "number", "upper")
# look at covariation among covariates
dat %>%
select(brood_year, herr_OEY_z, herr_OEY1_z, rkw_z) %>%
as.matrix() %>%
cor() %>%
corrplot::corrplot(., method = "number", "upper")
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = 4) +
s(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = 4),
data = dat)
# Combined models to resolve whether relationships are additive
n_stks <- length(unique(dat$n_stks))
n_stks
# Combined models to resolve whether relationships are additive
n_stks <- length(unique(dat$stock))
n_stks
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(4, 4, 13)) +
s(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, 13)),
data = dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(3, 3, n_stks)) +
s(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(3, 3)) +
s(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(3, 3)) #+
# s(herr_OEY1_z, rkw_z, stock, m = 2,
#   bs = c("tp", "tp", "re"), k = c(3, 3, n_stks))
,
data = dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(4, 4)) #+
# s(herr_OEY1_z, rkw_z, stock, m = 2,
#   bs = c("tp", "tp", "re"), k = c(3, 3, n_stks))
,
data = dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z, m = 2,
bs = c("tp", "tp"), k = c(5, 5)) #+
# s(herr_OEY1_z, rkw_z, stock, m = 2,
#   bs = c("tp", "tp", "re"), k = c(3, 3, n_stks))
,
data = dat)
glimpse(dat)
k_h_int_mod <- gam(gen_length ~ s(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(5, 5), m = 2) #+
# s(herr_OEY1_z, rkw_z, stock, m = 2,
#   bs = c("tp", "tp", "re"), k = c(3, 3, n_stks))
,
data = dat)
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) #+
# s(herr_OEY1_z, rkw_z, stock, m = 2,
#   bs = c("tp", "tp", "re"), k = c(3, 3, n_stks))
,
data = dat)
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
s(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat)
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat)
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod, k_h_hj_mod)
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)),
data = dat)
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod, k_h_hj_mod)
h_hj_mod <- gam(gen_length ~ s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat)
k_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat)
k_h_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat)
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)),
data = dat)
k_h_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat)
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod, k_h_hj_mod)
h_hj_mod <- gam(gen_length ~ s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat,
method = "REML")
k_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat,
method = "REML")
k_h_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat,
method = "REML")
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)),
data = dat,
method = "REML")
k_h_hj_mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat,
method = "REML")
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod, k_h_hj_mod)
k_hj_int_mod <- gam(gen_length ~ te(herr_OEY_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)),
data = dat,
method = "REML")
k_h_hj_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)) +
te(herr_OEY_z, rkw_z,
bs = c("tp", "tp"), k = c(4, 4), m = 2) +
t2(herr_OEY_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(4, 4, n_stks)),
data = dat,
method = "REML")
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod,
k_h_hj_mod, k_hj_int_mod, k_h_hj_int_mod)
k_h_hj_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)) +
te(herr_OEY_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat,
method = "REML")
k_h_int_mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat,
method = "REML")
k_hj_int_mod <- gam(gen_length ~ te(herr_OEY_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat,
method = "REML")
AIC(h_mod1, hj_mod1, k_mod2, h_hj_mod, k_hj_mod, k_h_mod, k_h_int_mod,
k_h_hj_mod, k_hj_int_mod, k_h_hj_int_mod)
glimpse(dat)
# look at raw data
p <- ggplot(dat, aes(y = gen_length)) +
facet_wrap(~fct_reorder(stock, a_group2))
# look at raw data
p <- ggplot(dat) +
facet_wrap(~fct_reorder(stock, a_group2)) +
ggsidekick::theme_sleek()
p +
geom_point(aes(x = herr_OEY_z, y = gen_length, fill = a_group2))
# look at raw data
p <- ggplot(dat) +
facet_wrap(~fct_reorder(stock, as.numeric(a_group2))) +
ggsidekick::theme_sleek()
p +
geom_point(aes(x = herr_OEY_z, y = gen_length, fill = a_group2))
p +
geom_point(aes(x = herr_OEY_z, y = gen_length, fill = a_group2), shape = 21)
p +
geom_point(aes(x = herr_OEY1_z, y = gen_length, fill = a_group2), shape = 21)
p +
geom_point(aes(x = rkw_z, y = gen_length, fill = a_group2), shape = 21)
# equivalent model to k_h_hj_mod
mod <- gam(gen_length ~ te(herr_OEY1_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY1_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)) +
te(herr_OEY_z, rkw_z,
bs = c("tp", "tp"), k = c(3, 3), m = 2) +
t2(herr_OEY_z, rkw_z, stock, m = 2,
bs = c("tp", "tp", "re"), k = c(3, 3, n_stks)),
data = dat,
method = "REML")
draw(mod)
hist(resid(mod))
# generate predictions for  model
excl_pars <- map(mod$smooth, function(x) x$label) %>% unlist
excl_pars
# equivalent model to k_h_hj_mod
mod <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 3) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY1_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY1_z, by = stock, m = 1, bs = "tp", k = 3) +
s(herr_OEY_z, m = 2, bs = "tp", k = 3) +
s(herr_OEY_z, by = stock, m = 1, bs = "tp", k = 3) +
s(stock, bs = "re"),
data = dat,
method = "REML")
# generate predictions for  model
excl_pars <- map(mod$smooth, function(x) x$label) %>% unlist
herr0_seq <- seq(min(dat$herr_OEY_z), max(dat$herr_OEY_z), length.out = 75)
herr1_seq <- seq(min(dat$herr_OEY1_z), max(dat$herr_OEY1_z), length.out = 75)
rkw_seq <- seq(min(dat$rkw_z), max(dat$rkw_z), length.out = 75)
AIC(k_mod1, k_mod2, k_mod3, k_mod4)
# RKW - greatest support for model 2 (global smooth and stock effects)
k_mod1 <- gam(gen_length ~  s(rkw_z, by = a_group2, m = 2, bs = "tp", k = 4) +
s(rkw_z, by = stock, m = 1, bs = "tp", k = 4) +
s(stock, bs = "re") +
a_group2,
data = dat)
AIC(k_mod1, k_mod2, k_mod3, k_mod4)
k_mod3 <- gam(gen_length ~ s(rkw_z, by = a_group2, m = 2, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
k_mod4 <- gam(gen_length ~ s(rkw_z, m = 2, bs = "tp", k = 4) +
s(stock, bs = "re"),
data = dat)
AIC(k_mod1, k_mod2, k_mod3, k_mod4)
# fixed effects predictions for herring at ocean entry
new_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0)
pred_herr0 <- predict(h_mod3, new_herr0, se.fit = TRUE,
exclude = excl_pars[grepl("stock", excl_pars)],
newdata.guaranteed = TRUE)
pred_herr0 <- predict(mod, new_herr0, se.fit = TRUE,
exclude = excl_pars[grepl("stock", excl_pars)],
newdata.guaranteed = TRUE)
new_dat <- new_herr0 %>%
mutate(link_fit = as.numeric(preds$fit),
link_se = as.numeric(preds$se.fit),
pred_gen = plogis(link_fit),
pred_gen_lo = plogis(link_fit + (qnorm(0.025) * link_se)),
pred_gen_up = plogis(link_fit + (qnorm(0.975) * link_se))
)
# function to generate predictions
gen_pred <- function(dat_in) {
preds <- predict(mod, dat_in, se.fit = TRUE,
exclude = excl_pars[grepl("stock", excl_pars)],
newdata.guaranteed = TRUE)
dat_in %>%
mutate(link_fit = as.numeric(preds$fit),
link_se = as.numeric(preds$se.fit),
pred_gen = plogis(link_fit),
pred_gen_lo = plogis(link_fit + (qnorm(0.025) * link_se)),
pred_gen_up = plogis(link_fit + (qnorm(0.975) * link_se))
)
}
gen_pred(new_herr0)
# fixed effects predictions for herring at ocean entry
new_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0)
fixed_preds_herr0 <- gen_pred(new_herr0)
# fixed effects predictions for herring at ocean entry
fixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0) %>%
gen_pred(., random = FALSE)
# function to generate predictions
gen_pred <- function(dat_in, random = FALSE) {
if (random == FALSE) {
preds <- predict(mod, dat_in, se.fit = TRUE,
exclude = excl_pars[grepl("stock", excl_pars)],
newdata.guaranteed = TRUE)
} else {
preds <- predict(mod, dat_in, se.fit = TRUE,
newdata.guaranteed = TRUE)
}
dat_in %>%
mutate(link_fit = as.numeric(preds$fit),
link_se = as.numeric(preds$se.fit),
pred_gen = plogis(link_fit),
pred_gen_lo = plogis(link_fit + (qnorm(0.025) * link_se)),
pred_gen_up = plogis(link_fit + (qnorm(0.975) * link_se))
)
}
# fixed effects predictions for herring at ocean entry
fixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0) %>%
gen_pred(., random = FALSE)
head(fixed_preds_herr0)
mean(dat$gen_length)
range(fixed_preds_herr0$pred_gen)
head(dat)
mean(dat$herr_OEY_z)
mean(dat$herr_OEY1_z)
mean(dat$herr_rkw_z)
mean(dat$herr_rkw_z, na.rm = T)
mean(dat$rkw_z, na.rm = T)
mixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0,
stock = unique(dat$stock)) %>%
gen_pred(., random = FALSE)
mixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0,
stock = unique(dat$stock)) %>%
gen_pred(., random = TRUE)
glimpse(mixed_preds_herr0)
# function to generate predictions
gen_pred <- function(dat_in, random = FALSE) {
if (random == FALSE) {
preds <- predict(mod, dat_in, se.fit = TRUE,
exclude = excl_pars[grepl("stock", excl_pars)],
newdata.guaranteed = TRUE)
} else {
preds <- predict(mod, dat_in, se.fit = TRUE,
newdata.guaranteed = TRUE)
}
dat_in %>%
mutate(pred_gen = as.numeric(preds$fit),
pred_gen_se = as.numeric(preds$se.fit),
pred_gen_lo = pred_gen + (qnorm(0.025) * pred_gen_se),
pred_gen_up = pred_gen + (qnorm(0.975) * pred_gen_se)
)
}
# fixed effects predictions for herring at ocean entry
fixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0) %>%
gen_pred(., random = FALSE)
range(fixed_preds_herr0$pred_gen)
mixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0,
stock = unique(dat$stock)) %>%
gen_pred(., random = TRUE)
# fixed effects predictions for herring at ocean entry
fixed_preds_herr0 <- expand.grid(herr_OEY_z = herr0_seq,
herr_OEY1_z = 0,
rkw_z = 0) %>%
gen_pred(., random = FALSE)
fixed_preds_herr0 %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen)) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up), alpha = 0.3) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length")
mixed_preds_herr0 %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen)) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up), alpha = 0.3) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length") +
facet_wrap(~stock)
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2), by = "stock")
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock")
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock") %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen), colour = a_group2) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up),
alpha = 0.3, fill = a_group2) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length") +
facet_wrap(~fct_reorder(stock, a_group2))
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock") %>%
glimpse()
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock") %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen, colour = a_group2)) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up, fill = a_group2),
alpha = 0.3) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length") +
facet_wrap(~fct_reorder(stock, a_group2))
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock") %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen, colour = a_group2)) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up, fill = a_group2),
alpha = 0.3) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length") +
facet_wrap(~fct_reorder(stock, as.factor(a_group2)))
mixed_preds_herr0 %>%
left_join(., dat %>% select(stock, a_group2) %>% distinct(), by = "stock") %>%
ggplot(., aes(x = herr_OEY_z)) +
geom_line(aes(y = pred_gen, colour = a_group2)) +
geom_ribbon(aes(ymin = pred_gen_lo, ymax = pred_gen_up, fill = a_group2),
alpha = 0.3) +
ggsidekick::theme_sleek() +
labs(x = "Herring Anomaly", y = "Predicted Generation Length") +
facet_wrap(~fct_reorder(stock, as.numeric(a_group2)))
