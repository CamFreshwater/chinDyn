---
title: "Power Analysis for Tagging"
author: "Cam Freshwater"
date: "April 8, 2019"
output: pdf_document
---
How many individuals necessary to estimate duration of residence and stock composition?

Principle steps for power analysis

  1. Level of precision desired - here we'll assume that either 10% or 25% precision is sufficient
  2. Find equation that links sample size w/ desired precision - e.g. for normal (n = ((t * s)/d)^2) where:
    - t is a constant typically set to 2
    - s is the standard deviation
    - d is the desired precision
  3. Estimate or guess unknown parameters (here use duration of residence of migrating juvenile sockeye salmon, then double it because adult Chinook salmon exhibit a greater range of migratory strategies).

```{r normalDist, echo=TRUE}
require(here)
soxDat <- read.csv(here("data/salmonData/soxOtolithData.csv"), stringsAsFactors = FALSE) 
migSD <- round(sd(soxDat$incrementCount), digits = 0) * 2
highPrec <- 5 #absolute precision is 5 days
lowPrec <- 10 #alternative lower precisions
tAlpha <- 2 #assume t_alpha is ~2 

# Assumes normal distribution
calcPower <- function(t = 2, sd, prec) {
  ((t * sd) / prec)^2
}

calcPower(sd = migSD, prec = lowPrec) #23 fish 
calcPower(sd = migSD, prec = highPrec) #92 fish 
```

Assuming a normal distribution for migration duration and reasonable levels of variation, ~20-90 fish are required to quantify variability in duration of residence within critical habitats with a precision of 5-10 days.  

Perhaps more correct to assume that migration duration is log-normally distributed. If so, it may also be appropriate to ask what size confidence intervals are generated by various sample sizes while assuming the same population characteristics as above. 

```{r logNormalDist}
logD <- mean(log(soxDat$incrementCount))
logDVar <- (sd(log(2 * soxDat$incrementCount)))^2

# Function to iterate across different sample sizes and determine what 
# percentage of the mean is included in 95% CI
estCI <- function(n., logMu, logVar) {
  mean. <- logMu + (logVar / 2) 
  int. <- 2.093 * (sqrt((logVar / n.) + ((logVar^2) / (2 * n. - 1))))
  low <- 1 - exp(mean. - int.) / exp(mean.)
  high <- exp(mean. + int.) / exp(mean.) - 1
  list(-low, high)
}
nSeq <- c(20, 50, 100, 150, 200)
outDat <- sapply(nSeq, function(x) estCI(x, logMu = logD, logVar = logDVar)) 
data.frame(n = nSeq,
           lowerInt = as.numeric(outDat[1, ]),
           upperInt = as.numeric(outDat[2, ]))
```

Assuming a log-normal distribution for migration duration, a sample of 20 individuals will produce a 95% confidence interval that has a 60% probability of containing the true mean, 100 individuals a ~80% probability and ~200 a ~90% probability.

Finally evaluate how many fish are required to identify difference between groups assuming $\alpha = 0.05$, reasonable statistical power (80%), and equivalent standard deviation in each group.

```{r estSampleSize2, echo=TRUE}
dif <- 10
pooledSD <- sqrt((12^2 + 12^2)/2)
	
pwr::pwr.t.test(d=dif/pooledSD, power=.8, sig.level=.05, type="two.sample",
                alternative="two.sided")
```

Approximately 25 fish necessary *per group* to detect difference of 10 days between two groups with a standard deviation in group-specific migration of 12 days.
